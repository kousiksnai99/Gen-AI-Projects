Event Hub Configuration


Resource Group:
rg-fbntf-ais-swce-poc


Subscription Name:
AZ-SUB-POC-AIS


Subscription ID:
4c85c528-9da9-48ac-a5c3-41bd351728eb


Location:
Sweden Central


Namespace Host Name:
ehn-hrmqc-ais-swce-poc.servicebus.windows.net


Event Hub Name:
ehn-hrmqc-ais-swce-poc


SAS Policy ARM ID:
/subscriptions/4c85c528-9da9-48ac-a5c3-41bd351728eb/resourceGroups/rg-fbntf-ais-swce-poc/providers/Microsoft.EventHub/namespaces/ehn-hrmqc-ais-swce-poc/authorizationrules/RootManageSharedAccessKey

az login
az account set --subscription "AZ-SUB-POC-AIS"


from azure.eventhub import EventHubProducerClient, EventData, TransportType
from azure.identity import DefaultAzureCredential

# Event Hub namespace + name
NAMESPACE = "ehn-hrmqc-ais-swce-poc.servicebus.windows.net"
EVENTHUB_NAME = "ehn-hrmqc-ais-swce-poc"

def main():
    # Authenticate using your Azure AD login
    credential = DefaultAzureCredential()

    # Create producer client using WebSockets (port 443)
    producer = EventHubProducerClient(
        fully_qualified_namespace=NAMESPACE,
        eventhub_name=EVENTHUB_NAME,
        credential=credential,
        transport_type=TransportType.AmqpOverWebsocket    # <-- important for VDI
    )

    print("Creating event batch...")
    event_data_batch = producer.create_batch()

    # Add messages
    event_data_batch.add(EventData("Hello Event Hub from AAD over WebSockets!"))

    print("Sending event...")
    producer.send_batch(event_data_batch)

    print("Event sent successfully!")

if __name__ == "__main__":
    main()



Creating event batch...
Traceback (most recent call last):
  File "F:\Kousik\helpdesk_assistant\eventhub_send.py", line 32, in <module>
    main()
    ~~~~^^
  File "F:\Kousik\helpdesk_assistant\eventhub_send.py", line 21, in main
    event_data_batch = producer.create_batch()
  File "C:\Users\KSNAI\AppData\Local\Programs\Python\Python313\Lib\site-packages\azure\eventhub\_producer_client.py", line 799, in create_batch
    self._get_max_message_size()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\KSNAI\AppData\Local\Programs\Python\Python313\Lib\site-packages\azure\eventhub\_producer_client.py", line 355, in _get_max_message_size
    cast(EventHubProducer, self._producers[ALL_PARTITIONS])._open_with_retry()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\KSNAI\AppData\Local\Programs\Python\Python313\Lib\site-packages\azure\eventhub\_producer.py", line 147, in _open_with_retry
    return self._do_retryable_operation(self._open, operation_need_param=False)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\KSNAI\AppData\Local\Programs\Python\Python313\Lib\site-packages\azure\eventhub\_client_base.py", line 608, in _do_retryable_operation
    raise last_exception from None
azure.eventhub.exceptions.AuthenticationError: CBS Token authentication failed.
Status code: None
Error: client-error
CBS Token authentication failed.
Status code: None
